// var layers = [];
// -------------- FUNCTIONS ------------
function maps() {
  var map;
    function initialize() {
      var mapOptions = {
        center: new google.maps.LatLng(37.769884, -122.459793),
        zoom: 10,
        mapTypeId: google.maps.MapTypeId.SATELLITE,
        mapTypeControlOptions: {
          style: google.maps.MapTypeControlStyle.DROPDOWN_MENU
        },
        zoomControlOptions: {
          style: google.maps.ZoomControlStyle.SMALL,
          position: google.maps.ControlPosition.RIGHT_BOTTOM
        },
        panControlOptions: {
          position: google.maps.ControlPosition.RIGHT_BOTTOM
        },
      };

      map = new google.maps.Map(document.getElementById("map"),
          mapOptions);

      // $.get("http://weather.yahooapis.com/forecastrss?w=12765839", function(xml) {
      //   $('weather', xml).each(function(i){
      //     lat = $(this).find('geo:lat').text();
      //     console.log(lat)
      //   })
      // })
      // var zips = [20001, 20002, 20003, 20004, 20005, 20006, 20007, 20008, 20009, 20010, 20011, 20012]
      // // console.log(zips)
      // for (var i = 0; i < zips.length; i++) {
      //    $.ajax({
      //       url : "http://api.wunderground.com/api/4c540d9ac42d77e1/geolookup/conditions/q/"+zips[i]+".json",
      //       dataType : "jsonp",
      //       success : function(parsed_json) { 
      //       var temp_f = parsed_json['current_observation']['temp_f'];
      //       var heatmap_data = new google.maps.LatLng(parsed_json['location']['lat'], parsed_json['location']['lon'])

      //     } 
      //    });
      // }

      // heatmap = new google.maps.visualization.HeatmapLayer({
      //         data: heatmap_data
      //       });
      //       heatmap.setMap(map);
          
          

      
      

      var flood_kml = new google.maps.KmlLayer({
        url: 'https://dl.dropboxusercontent.com/u/22757148/floodmap.kml'
      });
      // var kmlLayer = new google.maps.KmlLayer({
      //   url: 'https://dl.dropboxusercontent.com/u/22757148/San%20Francisco%20Neighborhood%20Maps.kml'
      // });
      var neighborhood_kml = new google.maps.KmlLayer({
        url: 'https://maps.google.com/maps/ms?dg=feature&ie=UTF8&authuser=0&msa=0&output=kml&msid=216722849731329970375.0004a2f137271f66502f6'
      });
      var neighborhood_kml2 = new google.maps.KmlLayer({
        url: 'https://maps.google.com/maps/ms?ie=UTF8&hl=en&source=embed&dg=feature&authuser=0&msa=0&output=kml&msid=216722849731329970375.0004a2f13b9644a6edc2f'
      });

      var zip_kmz = new google.maps.KmlLayer({
        // url: 'https://dl.dropboxusercontent.com/u/22757148/DC_Zipcodes.KML'
        url:"https://dl.dropboxusercontent.com/u/22757148/DC%20Zipcodes.kml"
      });

      var weatherLayer = new google.maps.weather.WeatherLayer();
      weatherLayer.setMap(map);
    
      $('#neighbor').on('click', function(){
        $('.container').hide();
        $('#neighbor-container').show();
        if ( neighborhood_kml.getMap() != null && neighborhood_kml2.getMap() != null) {
            neighborhood_kml.setMap(null);
            neighborhood_kml2.setMap(null);
        }
        else {
            neighborhood_kml.setMap(map);
            neighborhood_kml2.setMap(map);
        }
      })
      $('#roads').on('click', function(){
        flood_kml.setMap(map);
      })
      $('#hazard').on('click', function(){
        if ( zip_kmz.getMap() != null) {
            zip_kmz.setMap(null);
        }
        else {
            zip_kmz.setMap(map);
        }
        // zip_kmz.set('preserveViewport', true);
      })
      markers();
      // $('button#search').on('click', function(){
        cooling_markers();
      // })
          

    }
    function markers() {
      var icon = "<%= asset_path 'cooling.png' %>"
      var bounds = new google.maps.LatLngBounds();

      $.getJSON("/cooling", function(json) {
        $.each(json, function(key, data) {
          var contentInfo = ("Name:"+" "+data.name+"</br>"+"Address:"+" "+data.address+"</br>"+"Phone:"+" "+data.phone+"</br>"+"Cooling Center Type:"+" "+data.center_type)
          var marker = new google.maps.Marker({
            position: new google.maps.LatLng(data.latitude, data.longitude),
            map: map,
            icon: icon,
            title: 'hello'
          });
          marker.setMap(null);

          bounds.extend(marker.position);

          $('#resources').on('click', function(){
            if ($(this).attr('class') == 'map-buttons active') {
              marker.setMap(map);
              map.fitBounds(bounds);
            } else {
              marker.setMap(null);
            }
          })
          var infowindow = new google.maps.InfoWindow({
              content: contentInfo
          });
          google.maps.event.addListener(marker, 'click', function() {
            infowindow.open(map,marker);
          });
        })
      })
    }

    function cooling_markers() {
      var icon = "<%= asset_path 'cooling.png' %>"
      var bounds = new google.maps.LatLngBounds();

        $.getJSON("/search?utf8=âœ“&search="+$('#search').val()+"&x=8&y=8", function(json) {
          $.each(json, function(key, data) {
            console.log(data.name)
            var contentInfo = ("Name:"+" "+data.name+"</br>"+"Address:"+" "+data.address+"</br>"+"Phone:"+" "+data.phone+"</br>"+"Cooling Center Type:"+" "+data.center_type)
            var marker = new google.maps.Marker({
              position: new google.maps.LatLng(data.latitude, data.longitude),
              map: map,
              icon: icon
            });
            // marker.setMap(null);

            bounds.extend(marker.position);

            $('#search').on('click', function(){
              // if ($(this).attr('class') == 'map-buttons active') {
              marker.setMap(map);
              map.fitBounds(bounds);
              // } else {
              //   marker.setMap(null);
              // }
            })
            var infowindow = new google.maps.InfoWindow({
                content: contentInfo
            });
            google.maps.event.addListener(marker, 'click', function() {
              infowindow.open(map,marker);
            });
          })
        })
      // } 
    }
    
    
    google.maps.event.addDomListener(window, 'load', initialize);
}

function button_clicks() {
  // $('.map-buttons').on('click', function(){
  //   if ($(this) == $('#neighbor')) {
  //     $('#neighbor-container').show();
  //     console.log($(this))
  //   }
  // })
  $('#prepare').on('click', function(){
    $('.container').hide();
    $('#prepare-container').show();
  })
  $('#advanced-search').on('click', function(){
    $('.container').hide();
    $('#advanced-container').show();
  })
  $('#recovery').on('click', function(){
    $('.container').hide();
    $('#recovery-container').show();
  })
  $('#myaccount').on('click', function(){
    $('.container').hide();
    $('#account-container').show();
  })
  $('#contact-info').on('click', function(){
    $(this).children().show();
  })
  $('#certifications').on('click', function(){
    $(this).children().show();
  })
  
  // $('#neighbor').on('click', function(){
  //   $('#neighbor-container').show();
  // })
}


//  ----------- ON DOCUMENT READY --------------
$(function() {
  
  $('.account-box').hide();
  $('.container').hide();
  $('.close').on('click', function() {
    $('.container').css('display', 'none');
    $('.container2').css('display', 'none');
  })
  // $('#prepare').on('click', function(){
  //   $('.container').show();
  // })
  maps();
  button_clicks();
  $('.map-buttons').on('click', function() {
    $(this).toggleClass('active');
    // $('#container').show();
  })


  // $("#myModal").modal({show:false });
});